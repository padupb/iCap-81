Crie uma aplica√ß√£o web completa chamada **i-CAP 5.0**, destinada √† gest√£o de pedidos log√≠sticos em obras de infraestrutura.

---

## üß± Tecnologias

- **Frontend:** React + TypeScript + Tailwind + shadcn/ui
- **Backend:** Node.js + Express + TypeScript
- **Banco de Dados:** PostgreSQL
- **ORM:** Drizzle
- **Uploads:** Multer
- **Autentica√ß√£o:** Sess√£o (`req.session.userId`)
- **Outros:** PWA opcional, compat√≠vel com uso em campo (mobile-first)

---

## üé® Interface e Navega√ß√£o

- **Drawer lateral fixo** com os seguintes bot√µes:
  - Dashboard
  - + Criar Pedido
  - + Nova Empresa
  - + Novo Produto
  - + Novo Usu√°rio
  - Pedidos
  - Produtos
  - Empresas
  - Ordens de Compra
  - Obras
  - Configura√ß√µes
  - Dev

- **Layout inspirado no ChatGPT**:
  - Minimalista
  - Inputs e cart√µes com cantos arredondados (rounded-2xl)
  - Cards com sombra suave
  - Layout ancorado no topo da tela
  - Compat√≠vel com dark mode

---

## üì¶ M√≥dulos Principais

### 1. **Usu√°rios**
- Campos: nome, email, telefone, empresa, fun√ß√£o
- Autentica√ß√£o via email + senha (sem hash em dev)
- Fun√ß√µes configur√°veis por categoria da empresa
- Controle de permiss√µes (ex: pode confirmar entrega)
- Suporte a login de keyuser com email `@admin.icap`

### 2. **Empresas**
- Cadastro com nome, endere√ßo, categoria
- Cada empresa pertence a uma categoria
- Categorias definem os pap√©is dispon√≠veis

### 3. **Fun√ß√µes (Roles)**
- Ligadas √† categoria da empresa
- Permiss√µes espec√≠ficas (ex: confirma√ß√£o de entrega)

### 4. **Produtos e Unidades**
- Produtos com nome, unidade e descri√ß√£o
- Unidades com nome e sigla
- Listagem, edi√ß√£o e exclus√£o

### 5. **Pedidos (Orders)**
- Campos:
  - produto, fornecedor, quantidade, local da obra
  - data de entrega, urg√™ncia (calculada)
  - status, usu√°rio solicitante, ordem de compra vinculada
- Campo `isUrgent` setado com base em diferen√ßa de dias e configura√ß√£o do sistema
- Cria√ß√£o de log no momento da solicita√ß√£o
- Pedidos urgentes com ordem de compra vinculada devem notificar aprovador (via log)
- Confirma√ß√£o de entrega via rota com status (Entregue ou Recusado) + coment√°rio
- Cadastro de documentos via upload

### 6. **Upload de Documentos**
- Upload via `multer` (at√© 3 arquivos: `nota_pdf`, `nota_xml`, `certificado_pdf`)
- Salvos em `uploads/{pedidoId}` com nome √∫nico
- Informa√ß√µes armazenadas em `orders.documentosinfo` (tipo JSONB)
- Flag `orders.documentoscarregados` = true
- Rotas para:
  - Upload
  - Verifica√ß√£o
  - Download por tipo (`/documentos/:tipo`)

### 7. **Rastreamento**
- Tabela `tracking_points`:
  - status, coment√°rio, geolocaliza√ß√£o, usu√°rio, timestamp
- Associado ao pedido
- Registrado na entrega/rejei√ß√£o

### 8. **Ordens de Compra**
- Cadastro de ordens com:
  - n√∫mero, empresa, obra, validade, status, valor total
  - itens vinculados (produto + quantidade)
- Valida√ß√£o de saldo ao criar pedido com ordem
- Rota `/saldo` retorna saldo dispon√≠vel
- Atualiza√ß√£o din√¢mica de status para "Expirado"
- Poss√≠vel excluir e atualizar ordem + itens

### 9. **Obras**
- Listagem de obras cadastradas
- Cada pedido pode estar vinculado a uma obra

### 10. **Configura√ß√µes**
- Chave/valor (ex: `urgent_days_threshold`, `keyuser_email`)
- API para `GET` e `POST`
- Usadas para controlar regras de neg√≥cio

### 11. **Logs do Sistema**
- A√ß√£o, item_type, item_id, detalhes
- Registram todas as opera√ß√µes cr√≠ticas

---

## üîê Sess√£o e Autentica√ß√£o

- Sess√£o armazenada em `req.session.userId`
- Verifica√ß√£o da sess√£o em todas as rotas sens√≠veis
- Rota `GET /api/auth/me` retorna dados do usu√°rio logado
- Rota `POST /api/auth/logout` limpa sess√£o

---

## üìÑ Estrutura de Banco (m√≠nima esperada)

### Tabelas:
- `users`, `companies`, `products`, `units`
- `orders`, `purchase_orders`, `itens_ordem_compra`, `obras`
- `company_categories`, `user_roles`, `system_logs`, `tracking_points`
- `settings`

### Altera√ß√µes:
```sql
ALTER TABLE orders ADD COLUMN documentoscarregados BOOLEAN DEFAULT false;
ALTER TABLE orders ADD COLUMN documentosinfo JSONB;
